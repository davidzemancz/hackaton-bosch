@page "/objednavka/new"
@using Bosch.Shared
@inject HttpClient Http
@inject NavigationManager Navigation

<h3>Nová objednávka</h3>

@if (Objednavka != null && Materialy != null)
{
    <EditForm Model="@Objednavka" OnValidSubmit="@HandleValidSubmit">
        <DataAnnotationsValidator />
        <ValidationSummary />
            <div class="mb-3">
            <select class="form-select" aria-label="Materiál" @bind="Objednavka.Mezisklad.Id">
                @foreach (var material in Materialy)
                {
                    <option value="@material.Id">@material.Nazev</option>
                }
            </select>
         </div>
        <button type="submit" class="btn btn-primary">Submit</button>
    </EditForm>
}

@code {
    private Objednavka Objednavka { get; set; } = new Objednavka();

    private Material[] Materialy;

     protected override async Task OnInitializedAsync()
    {
        Materialy = await Http.GetFromJsonAsync<Material[]>("/api/material/list");
    }

    private async void HandleValidSubmit()
    {
        await Http.PostAsJsonAsync<Objednavka>("/api/objednavka/save", Objednavka);
        Navigation.NavigateTo("/objednavky");
    }
}

